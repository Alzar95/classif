<div class="eos-dictionary" [ngClass]="{'full': currentState === states.full,
        'only-selected': currentState === states.selected,
        'info': currentState === states.info,
        'tree': currentState === states.tree}" (window:resize)="resize()">
    <div class="tree-wrapper" [ngClass]="{'open-tree': currentState === states.full || currentState === states.tree,
        'has-spinner': !treeNodes.length}">
        <eos-spinner *ngIf="!treeNodes.length" size="lg"></eos-spinner>
        <eos-tree *ngIf="treeNodes.length" [nodes]="treeNodes" [showDeleted]="params.showDeleted"></eos-tree>
    </div>
    <div class="selected-wrapper" [ngClass]="{'open-tree': currentState === states.full || currentState === states.tree}" (click)="onClick()">
        <div class="node-actions">
            <div *ngIf="_selectedNode" class="block selected-node" [ngClass]="{'no-parent': !params.hasParent}">
                <button *ngIf="params.hasParent" class="btn btn-primary-light" (click)="goUp()">
                    <span class="eos-icon eos-icon-arrow-blue-left"></span>
                </button>
                <span class="selected-node-title">{{_selectedNodeText}}</span>
            </div>
            <div class="first-line block">
                <div class="controller pull-left">
                    <eos-node-actions [params]="params" (action)="doAction($event)"></eos-node-actions>
                </div>
                <div class="pull-right">
                    <eos-dictionary-search></eos-dictionary-search>
                </div>
            </div>
            <div class="second-line block special-text">
                <div class="second-line-content">
                    <span *ngIf="params.showCheckbox" class="checkbox-inline">
                        <label tooltip="{{ anyMarked ? 'Снять пометки':'Пометить все'}}" [ngClass]="{'group-checkbox': anyUnmarked && anyMarked}"
                            containerClass="tooltip-info">
                            <input type="checkbox" [(ngModel)]="allMarked" (change)="toggleAllMarks()">
                            <span></span>
                        </label>
                    </span>
                    <span class="node-title">
                        <span *ngFor="let field of viewFields" class="item" [ngClass]="{'user-sort': this.params.userSort}"
                            [ngStyle]="{'width.%': length[field.key]}">{{field.title}}</span>
                    </span>
                    <button class="btn btn-primary-light pull-right config-btn" tooltip="Настройка отображения" containerClass="tooltip-info"
                        placement="left" (click)="_configColumns()"><i class="fa fa-cog" aria-hidden="true"></i></button>
                </div>
            </div>
        </div>
        <eos-node-list [nodes]="visibleNodes" [params]="params" [length]="length" (change)="updateMarks()"></eos-node-list>
        <eos-node-list-pagination [total]="listNodes?.length" (change)="pageChanged($event)"></eos-node-list-pagination>
    </div>
    <div class="opened-wrapper" [ngClass]="{'open-info': currentState === states.full || currentState === states.info}">
        <eos-node-info (action)=doAction($event)></eos-node-info>
    </div>
</div>

<ng-template #createTpl>
    <div class="modal-header">
        <h4 class="modal-title pull-left">Добавление записи</h4>
        <button type="button" class="close pull-right" aria-label="Close" (click)="cancelCreate()">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="create-new-node modal-body">
        <eos-card-edit [dictionaryId]="dictionaryId" [fieldsDescription]="fieldsDescription" [data]="nodeData" editMode="true" (invalid)="validate($event)" ></eos-card-edit>
    </div>
    <div class="modal-footer">
        <button class="btn btn-primary-full" [disabled]="formValidated" (click)="create()">Добавить</button>
        <button class="btn btn-primary-full" [disabled]="formValidated" (click)="create(false)">Добавить ещё</button>
        <button class="btn btn-primary" (click)="cancelCreate()">Отмена</button>
    </div>
</ng-template>
