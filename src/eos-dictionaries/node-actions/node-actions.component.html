<div class="eos-node-actions">
    <ng-container *ngFor="let item of buttons">
        <ng-container *ngTemplateOutlet="btnTpl; context: item"></ng-container>
    </ng-container>

    <div class="actions"
        dropdown
        container="body"
        #dropdown="bs-dropdown">
        <button class="btn btn-primary-light actions"
            tooltip="Показать меню"
            #itemTooltip="bs-tooltip"
            placement="bottom"
            containerClass="tooltip-info"
            dropdownToggle
            (click)="itemTooltip.hide()">
            <span class="eos-icon eos-icon-fab-blue small"></span>
        </button>
        <ul *dropdownMenu
            class="dropdown-menu"
            role="menu">
            <li *ngFor="let item of buttons"
                role="menuitem"
                placement="right"
                container="body"
                dropdown
                triggers="mouseclick"
                class="menuitem selected">
                <a class="dropdown-item f-14 selected"
                    tooltip="{{item.hint}}"
                    placement="bottom"
                    containerClass="tooltip-info"
                    *ngIf="item.show && item.type !== ADD_ACTION && isTree"
                    (click)="doAction(item.type); dropdown.hide()">
                    <div class="drop-ico">
                        <span *ngIf="!item.isActive"
                            class="{{item.iconClass}}"></span>
                        <span *ngIf="item.isActive"
                            class="{{item.activeIconClass}}"></span>
                    </div>
                    <span>{{item.title}}</span>
                </a>

                <a class="dropdown-item f-14 selected"
                    dropdownToggle
                    tooltip="{{item.hint}}"
                    placement="bottom"
                    containerClass="tooltip-info"
                    *ngIf="item.show && item.type === ADD_ACTION && isTree"
                    (click)="stopCloseMenu($event)">
                    <div class="drop-ico">
                        <span *ngIf="!item.isActive"
                            class="{{item.iconClass}}"></span>
                        <span *ngIf="item.isActive"
                            class="{{item.activeIconClass}}"></span>
                    </div>
                    <span>{{item.title}}</span>
                </a>
                <!--
                <button dropdownToggle
                    *ngIf="item.show && item.type === ADD_ACTION && isTree"
                    [disabled]="!item.enabled"
                    [ngClass]="{active: item.isActive}"
                    class="action-dropdown-item btn btn-primary-light hidden-lg"
                    (click)="stopCloseMenu($event)"
                    tooltip="{{item.hint}}"
                    placement="bottom"
                    containerClass="tooltip-info">
                        <span *ngIf="!item.isActive" class="{{item.iconClass}}"></span>
                        <span *ngIf="item.isActive" class="{{item.activeIconClass}}"></span>
                        <span class="drop-title">{{item.title}}</span>
                </button>-->

                <ul *dropdownMenu
                    class="dropdown-menu menu-two-lvl hidden-lg"
                    role="menu">
                    <li class="menuitem"
                        *ngFor="let type of addMenu"
                        role="menuitem">
                        <a class="dropdown-item f-14 selected have-padding"
                            tooltip="{{item.hint}}"
                            placement="bottom"
                            containerClass="tooltip-info"
                            (click)="doAction(item.type, type.params)">
                                <span>{{type.title}}</span>
                            </a>
                    </li>
                </ul>
            </li>

            <li *ngFor="let item of moreButtons"
                role="menuitem"
                class="menuitem">
                <a class="dropdown-item f-14 selected"
                    tooltip="{{item.hint}}"
                    placement="bottom"
                    containerClass="tooltip-info"
                    *ngIf="item.show"
                    (click)="doAction(item.type)">
                    <div class="drop-ico">
                        <span *ngIf="!item.isActive"
                            class="{{item.iconClass}}"></span>
                        <span *ngIf="item.isActive"
                            class="{{item.activeIconClass}}"></span>
                    </div>
                    <span>{{item.title}}</span>
                </a>
            </li>
        </ul>
    </div>
</div>

<ng-template #btnTpl
    let-show="show"
    let-hint="hint"
    let-enabled="enabled"
    let-isActive="isActive"
    let-buttonClass="buttonClass"
    let-icon="iconClass"
    let-activeIcon="activeIconClass"
    let-action="type">
    <span class="visible-lg-inline-block actions"
        *ngIf="show">
        <ng-container *ngIf="action === ADD_ACTION && isTree">
            <span class="btn-group" dropdown>
                <div [tooltip]="hint" #itemTooltip="bs-tooltip" placement="bottom" containerClass="tooltip-info">
                    <button [disabled]="!enabled" class="btn btn-primary-light {{buttonClass}}" dropdownToggle [ngClass]="{active: isActive}" (click)="itemTooltip.hide();">
                        <span [hidden]="isActive" [ngClass]="icon"></span>
    <span [hidden]="!isActive"
        [ngClass]="activeIcon"></span>
    </button>
    </div>
    <ul *dropdownMenu
        class="dropdown-menu"
        role="menu">
        <li *ngFor="let item of addMenu"
            role="menuitem"
            class="menuitem">
            <a class="dropdown-item f-14 selected have-padding"
                tooltip="{{item.hint}}"
                placement="bottom"
                containerClass="tooltip-info">
                <span>{{item.title}}</span>
            </a>
        </li>
    </ul>
    </span>
    </ng-container>
    <ng-container *ngIf="action !== ADD_ACTION || !isTree">
        <div [tooltip]="hint"
            #itemTooltip="bs-tooltip"
            placement="bottom"
            containerClass="tooltip-info">
            <button [disabled]="!enabled"
                class="btn btn-primary-light {{buttonClass}}"
                [ngClass]="{active: isActive}"
                (click)="itemTooltip.hide(); doAction(action)">
                    <span [hidden]="isActive" [ngClass]="icon"></span>
                    <span [hidden]="!isActive" [ngClass]="activeIcon"></span>
            </button>
        </div>
    </ng-container>
    </span>
</ng-template>
