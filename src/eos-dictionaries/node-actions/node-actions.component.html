<div class="eos-node-actions">
    <ng-container *ngFor="let item of buttons">
        <ng-container *ngTemplateOutlet="btnTpl; context: item"></ng-container>
    </ng-container>

    <div class="actions"
        dropdown
        container="body" #dropdown="bs-dropdown">
        <button class="btn btn-primary-light actions" tooltip="Показать меню" #itemTooltip="bs-tooltip"
            placement="bottom" containerClass="tooltip-info" dropdownToggle (click)="itemTooltip.hide()">
            <span class="eos-icon eos-icon-fab-blue small rotate"></span>
        </button>
        <ul *dropdownMenu
            class="dropdown-menu"
            role="menu">
            <li *ngFor="let item of buttons"
                role="menuitem"
                placement="right" container="body"
                dropdown
                triggers="mouseclick">
                <div tooltip="{{item.hint}}"
                placement="bottom"
                containerClass="tooltip-info">
                <button *ngIf="item.show && item.type !== ADD_ACTION && isTree"
                    [disabled]="!item.enabled"
                    [ngClass]="{active: item.isActive}"
                    class="action-dropdown-item btn btn-primary-light hidden-lg"
                    (click)="doAction(item.type); dropdown.hide()">
                        <span *ngIf="!item.isActive" class="{{item.iconClass}}"></span>
                        <span *ngIf="item.isActive" class="{{item.activeIconClass}}"></span>
                        <span class="drop-title">{{item.title}}</span>
                </button>
                <button dropdownToggle *ngIf="item.show && item.type === ADD_ACTION && isTree"
                    [disabled]="!item.enabled"
                    [ngClass]="{active: item.isActive}"
                    class="action-dropdown-item btn btn-primary-light hidden-lg"
                    (click)="stopCloseMenu($event)"
                    tooltip="{{item.hint}}"
                    placement="bottom"
                    containerClass="tooltip-info">
                        <span *ngIf="!item.isActive" class="{{item.iconClass}}"></span>
                        <span *ngIf="item.isActive" class="{{item.activeIconClass}}"></span>
                        <span class="drop-title">{{item.title}}</span>
                </button>
                </div>

                <ul *dropdownMenu class="dropdown-menu menu-two-lvl hidden-lg" role="menu">
                    <li *ngFor="let type of addMenu" role="menuitem">
                        <button class="action-dropdown-item btn btn-primary-light"
                            (click)="doAction(item.type, type.params)">{{type.title}}</button>
                    </li>
                </ul>
            </li>
            <li *ngFor="let item of moreButtons"
                role="menuitem">
                <div tooltip="{{item.hint}}"
                placement="bottom"
                containerClass="tooltip-info">
                <button *ngIf="item.show"
                    [disabled]="!item.enabled"
                    [ngClass]="{active: item.isActive}"
                    class="action-dropdown-item btn btn-primary-light"
                    (click)="doAction(item.type)">
                        <span [ngClass]="item.activeIconClass" class="{{item.iconClass}}"></span>
                        <span class="drop-title">{{item.title}}</span>
                </button>
                </div>
            </li>
        </ul>
    </div>
</div>

<ng-template #btnTpl
    let-show="show"
    let-hint="hint"
    let-enabled="enabled"
    let-isActive="isActive"
    let-buttonClass="buttonClass"
    let-icon="iconClass"
    let-activeIcon="activeIconClass"
    let-action="type">
    <span class="visible-lg-inline-block actions"
        *ngIf="show">
        <ng-container *ngIf="action === ADD_ACTION && isTree">
            <span class="btn-group" dropdown>
                <div [tooltip]="hint" #itemTooltip="bs-tooltip" placement="bottom" containerClass="tooltip-info">
                    <button [disabled]="!enabled" class="btn btn-primary-light {{buttonClass}}" dropdownToggle [ngClass]="{active: isActive}" (click)="itemTooltip.hide();">
                        <span [hidden]="isActive" [ngClass]="icon"></span>
                        <span [hidden]="!isActive"
                            [ngClass]="activeIcon"></span>
                    </button>
                </div>
                <ul *dropdownMenu
                    class="dropdown-menu"
                    role="menu">
                    <li *ngFor="let item of addMenu"
                        role="menuitem">
                        <button class="action-dropdown-item btn btn-primary-light"
                        (click)="doAction(action,item.params)">{{item.title}}</button>
                    </li>
                </ul>
            </span>
        </ng-container>
        <ng-container *ngIf="action !== ADD_ACTION || !isTree">
            <span class="btn-group">
                <div [tooltip]="hint"
                    #itemTooltip="bs-tooltip"
                    placement="bottom"
                    containerClass="tooltip-info">
                    <button [disabled]="!enabled"
                        class="btn btn-primary-light {{buttonClass}}"
                        [ngClass]="{active: isActive}"
                        (click)="itemTooltip.hide(); doAction(action)">
                    <span [hidden]="isActive" [ngClass]="icon"></span>
                    <span [hidden]="!isActive" [ngClass]="activeIcon"></span>
                    </button>
                </div>
            </span>
        </ng-container>
    </span>
</ng-template>
