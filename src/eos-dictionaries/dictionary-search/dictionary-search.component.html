<div class="eos-dictionary-search">
    <div [ngClass]="{'hidden': !hasDate}"
        class="date-filter-wrapper">
        <span class="date">Состояние на: </span>
        <span>
        <eos-datepicker [placeholder]="'дд.мм.гггг'"
            [value]="date"
            (dateChange)="dateFilter($event)"
            [isReadonly]="false"></eos-datepicker>
        </span>
    </div>
    <div [popover]="searchModal"
        containerClass="full-search-popover"
        class="search-btn-wraper"
        placement="bottom"
        #full="bs-popover"
        [outsideClick]="true"
        (onShown)="isOpenFull = true"
        (onHidden)="isOpenFull = false">
        <button [ngClass]="{'hidden': !hasFull, 'opened': isOpenFull || !noSearchData }"
            class="btn btn-primary-light search-btn"
            tooltip="Расширенный поиск"
            placement="bottom"
            container="body"
            containerClass="tooltip-info">
            <i [hidden]="isOpenFull || !noSearchData" class="eos-icon eos-icon-filter-blue small" aria-hidden="true"></i>
            <i [hidden]="!(isOpenFull || !noSearchData)" class="eos-icon eos-icon-filter-white small" aria-hidden="true"></i>
        </button>
    </div>
    <div class="search-btn-wraper"
        tooltip="Быстрый поиск"
        placement="bottom"
        container="body"
        containerClass="tooltip-info"
        [isDisabled]="isOpenQuick">
        <button [ngClass]="{'hidden': !hasQuick, 'opened': isOpenQuick}"
            class="btn btn-primary-light search-btn quick-search-btn"
            [popover]="quickSearchModal"
            containerClass="quick-search-popover"
            placement="left"
            #quick="bs-popover"
            [outsideClick]="true"
            (onShown)="setFocus(); isOpenQuick = true"
            (onHidden)="isOpenQuick = false">
            <i [hidden]="isOpenQuick" class="eos-icon eos-icon-search-blue small" aria-hidden="true"></i>
            <i [hidden]="!isOpenQuick" class="eos-icon eos-icon-search-white small" aria-hidden="true"></i>
    </button>
    </div>
</div>

<ng-template #quickSearchModal>
    <div *ngIf="type === 1 || type === 2">
        <div class="quick-search-top usual-border">
            <span class="pull-left title">Область быстрого поиска</span>
        </div>
        <div class="col-1 quickRadio">
            <form>
                <div class="radio-inline quick">
                    <label>
                    <input type="radio" name="quick-space" [value]="0" [(ngModel)]="settings.mode">
                    <span></span>Во всём справочнике</label>
                </div>
                <div class="radio-inline quick">
                    <label>
                        <input type="radio" name="quick-space" [value]="2" [(ngModel)]="settings.mode">
                        <span></span>В текущей ветке</label>
                </div>
            </form>
        </div>
    </div>
    <div class="quickInput">
        <input (keydown)="quickSearch($event)"
            id="inpQuick"
            type="text"
            name="quick"
            class="form-control quick-search-form usual-border"
            [(ngModel)]="dataQuick"
            required>
        <button class="btn btn-default clear-btn"
            *ngIf="isOpenQuick"
            (click)="clearQuickForm()">
            <span class="eos-icon eos-icon-close-blue"></span>
        </button>
    </div>
</ng-template>

<ng-template #searchModal>
    <div class="full-search-top usual-border">
        <span class="pull-left title">Область поиска</span>
        <div class="pull-right srch-btns">
            <button [disabled]="noSearchData"
                class="btn btn-primary s-font upper"
                (click)="clearForm()">Сбросить</button>
            <button [disabled]="noSearchData"
                (click)="fullSearch()"
                class="btn btn-primary-full s-font upper">Найти</button>
        </div>
    </div>
    <div>
        <form #searchForm="ngForm">
            <div class="full-search-settings-container usual-border">
                <div class="radio-inline">
                    <label>
                        <input type="radio" name="full-space" [value]="0" [(ngModel)]="mode">
                        <span></span>Во всём справочнике</label>
                </div>
                <div class="radio-inline">
                    <label>
                        <input type="radio" name="full-space" [value]="1" [(ngModel)]="mode">
                        <span></span>В текущей ветке</label>
                </div>
                <div class="radio-inline">
                    <label>
                        <input type="radio" name="full-space" [value]="2" [(ngModel)]="mode">
                        <span></span>Текущая и подчиненные</label>
                </div>
                <div class="checkbox-inline">
                    <label>
                        <input type="checkbox" name="seeDelete" [(ngModel)]="settings.deleted">
                        <span></span>Учитывать логически удаленные</label>
                </div>
            </div>

            <div *ngIf="loading"
                class="spinner-wrapper">
                <eos-spinner size="md"></eos-spinner>
            </div>
            <div [hidden]="dictId !== 'departments'"
                class="full-search-form"
                *ngIf="data.rec && data['printInfo']">
                <div *ngIf="modes"
                    class="tabs-wrapper usual-border">
                    <ul class="tabs">
                        <li class="tab-item"
                            *ngFor="let tab of modes"
                            role="presentation"
                            [ngClass]="{'active-border secondary-text': tab.key === currTab}"
                            (click)="setTab(tab.key)">
                            <span class="tab-title">{{tab.title}}</span>
                        </li>
                    </ul>
                </div>
                <div *ngIf="currTab === 'person'">
                    <form id="person">
                        <div class="row">
                            <div class="form-group unimportant-text col-md-3 col-lg-3 col-xl-3">
                                <label for="CODE_PERSON">{{fieldsDescription.rec['CODE']?.title}}</label>
                                <div class="wrap">
                                    <input id="CODE_PERSON"
                                        name="CODE_PERSON"
                                        type="text"
                                        class="form-control light"
                                        [(ngModel)]="person.rec['CODE']"
                                        placeholder="{{fieldsDescription.rec['CODE']?.title}}"
                                        maxlength="{{fieldsDescription.rec['CODE']?.length}}">
                                    <button [ngClass]="{'hide': !person.rec['CODE']}"
                                        (click)="person.rec['CODE'] = ''">
                                        <span class="eos-icon eos-icon-close-blue"></span>
                                    </button>
                                </div>
                            </div>

                            <div class="form-group unimportant-text col-md-9 col-lg-9 col-xl-9">
                                <label for="SURNAME">Фамилия</label>
                                <div class="wrap">
                                    <input id="SURNAME"
                                        name="SURNAME"
                                        type="text"
                                        class="form-control light"
                                        [(ngModel)]="person['printInfo']['SURNAME']"
                                        placeholder="Фамилия"
                                        maxlength="64"
                                        readonly>
                                    <button [ngClass]="{'hide': !person['printInfo']['SURNAME']}"
                                        (click)="person['printInfo']['SURNAME'] = ''">
                                        <span class="eos-icon eos-icon-close-blue"></span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="row no-top-margin">
                            <div class="form-group unimportant-text col-md-3 col-lg-3 col-xl-3">
                                <label for="PHONE">{{fieldsDescription.rec['PHONE']?.title}}</label>
                                <div class="wrap">
                                    <input id="PHONE"
                                        name="PHONE"
                                        type="text"
                                        class="form-control light"
                                        [(ngModel)]="person.rec['PHONE']"
                                        placeholder="{{fieldsDescription.rec['PHONE']?.title}}"
                                        maxlength="{{fieldsDescription.rec['PHONE']?.length}}">
                                    <button [ngClass]="{'hide': !person.rec['PHONE']}"
                                        (click)="person.rec['PHONE'] = ''">
                                        <span class="eos-icon eos-icon-close-blue"></span>
                                    </button>
                                </div>
                            </div>

                            <div class="col-md-9 col-lg-9 col-xl-9">
                                <div class="row">
                                    <div class="form-group unimportant-text col-md-6 col-lg-6 col-xl-6">
                                        <label for="NAME">Имя</label>
                                        <div class="wrap">
                                            <input id="NAME"
                                                name="NAME"
                                                type="text"
                                                class="form-control light"
                                                [(ngModel)]="person['printInfo']['NAME']"
                                                placeholder="Имя"
                                                maxlength="64"
                                                readonly>
                                            <button [ngClass]="{'hide': !person['printInfo']['NAME']}"
                                                (click)="person['printInfo']['NAME'] = ''">
                                                <span class="eos-icon eos-icon-close-blue"></span>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="form-group unimportant-text col-md-6 col-lg-6 col-xl-6">
                                        <label for="PATRON">Отчество</label>
                                        <div class="wrap">
                                            <input id="PATRON"
                                                name="PATRON"
                                                type="text"
                                                class="form-control light"
                                                [(ngModel)]="person['printInfo']['PATRON']"
                                                placeholder="Отчество"
                                                maxlength="64"
                                                readonly>
                                            <button [ngClass]="{'hide': !person['printInfo']['PATRON']}"
                                                (click)="person['printInfo']['PATRON'] = ''">
                                                <span class="eos-icon eos-icon-close-blue"></span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row no-top-margin">
                            <div class="form-group unimportant-text col-md-3 col-lg-3 col-xl-3">
                                <label for="E_MAIL">{{fieldsDescription.rec['E_MAIL']?.title}}</label>
                                <div class="wrap">
                                    <input id="E_MAIL"
                                        name="E_MAIL"
                                        type="text"
                                        class="form-control light"
                                        [(ngModel)]="person.rec['E_MAIL']"
                                        placeholder="{{fieldsDescription.rec['E_MAIL']?.title}}"
                                        maxlength="{{fieldsDescription.rec['E_MAIL']?.length}}">
                                    <button [ngClass]="{'hide': !person.rec['E_MAIL']}"
                                        (click)="person.rec['E_MAIL'] = ''">
                                        <span class="eos-icon eos-icon-close-blue"></span>
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-9 col-lg-9 col-xl-9">
                                <div class="row">
                                    <div class="form-group unimportant-text col-md-6 col-lg-6 col-xl-6">
                                        <label for="DUTY">{{fieldsDescription.rec['DUTY']?.title}}</label>
                                        <div class="wrap">
                                            <input id="DUTY"
                                                name="DUTY"
                                                type="text"
                                                class="form-control light"
                                                [(ngModel)]="person.rec['DUTY']"
                                                placeholder="{{fieldsDescription.rec['DUTY']?.title}}"
                                                maxlength="{{fieldsDescription.rec['DUTY']?.length}}">
                                            <button [ngClass]="{'hide': !person.rec['DUTY']}"
                                                (click)="person.rec['DUTY'] = ''">
                                                <span class="eos-icon eos-icon-close-blue"></span>
                                            </button>
                                        </div>
                                    </div>

                                    <div class="form-group unimportant-text col-md-6 col-lg-6 col-xl-6">
                                        <label for="fullPosition">{{fieldsDescription.rec['fullPosition']?.title}}</label>
                                        <div class="wrap">
                                            <input id="fullPosition"
                                                name="fullPosition"
                                                type="text"
                                                class="form-control light"
                                                [(ngModel)]="person.rec['FULLNAME']"
                                                placeholder="{{fieldsDescription.rec['fullPosition']?.title}}"
                                                maxlength="{{fieldsDescription.rec['fullPosition']?.length}}">
                                            <button [ngClass]="{'hide': !person.rec['FULLNAME']}"
                                                (click)="person.rec['FULLNAME'] = ''">
                                                <span class="eos-icon eos-icon-close-blue"></span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row no-top-margin">
                            <div class="form-group unimportant-text col-md-3 col-lg-3 col-xl-3"></div>
                            <div class="form-group unimportant-text col-md-9 col-lg-9 col-xl-9">
                                <label for="PERSON_NOTE">{{fieldsDescription.rec['NOTE']?.title}}</label>
                                <div class="wrap">
                                    <input id="PERSON_NOTE"
                                        name="PERSON_NOTE"
                                        type="text"
                                        class="form-control light"
                                        [(ngModel)]="person.rec['NOTE']"
                                        placeholder="{{fieldsDescription.rec['NOTE']?.title}}"
                                        maxlength="{{fieldsDescription.rec['NOTE']?.length}}"
                                        readonly>
                                    <button [ngClass]="{'hide': !person.rec['NOTE']}"
                                        (click)="person.rec['NOTE'] = ''">
                                        <span class="eos-icon eos-icon-close-blue"></span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>

                <div *ngIf="currTab === 'cabinet'">
                    <form id="cabinet">
                        <div class="form-group unimportant-text">
                            <label for="titleRoom">{{fieldsDescription.rec['titleRoom']?.title}}</label>
                            <div class="wrap">
                                <input id="titleRoom"
                                    name="titleRoom"
                                    type="text"
                                    class="form-control light"
                                    [(ngModel)]="data.cabinet['CABINET_NAME']"
                                    placeholder="{{fieldsDescription.rec['titleRoom']?.title}}">
                                <button [ngClass]="{'hide': !data.cabinet['CABINET_NAME']}"
                                    (click)="data.cabinet['CABINET_NAME'] = ''">
                                    <span class="eos-icon eos-icon-close-blue"></span>
                                </button>
                            </div>
                        </div>
                        <!--
                        <div class="form-group unimportant-text">
                            <label for="fullTitleRoom" >{{fieldsDescription.rec['fullTitleRoom']?.title}}</label>
                            <input id="fullTitleRoom" name="fullTitleRoom" type="text" class="form-control light"
                                [(ngModel)]="data.rec['fullTitleRoom']"
                                placeholder="{{fieldsDescription.rec['fullTitleRoom']?.title}}" >
                        </div>
                        -->
                    </form>
                </div>
                <div *ngIf="currTab === 'department'"
                    class="row">
                    <form id="department">
                        <div class="col-md-3 col-lg-3 col-xl-3">
                            <div class="form-group unimportant-text">
                                <label for="CODE">{{fieldsDescription.rec['CODE']?.title}}</label>
                                <div class="wrap">
                                    <input id="CODE"
                                        name="CODE"
                                        type="text"
                                        class="form-control light"
                                        [(ngModel)]="department.rec['CODE']"
                                        placeholder="{{fieldsDescription.rec['CODE']?.title}}"
                                        maxlength="{{fieldsDescription.rec['CODE']?.length}}">
                                    <button [ngClass]="{'hide': !department.rec['CODE']}"
                                        (click)="department.rec['CODE'] = ''">
                                        <span class="eos-icon eos-icon-close-blue"></span>
                                    </button>
                                </div>
                            </div>
                            <div class="form-group unimportant-text">
                                <label for="indexDep">{{fieldsDescription.rec['indexDep']?.title}}</label>
                                <div class="wrap">
                                    <input id="indexDep"
                                        name="indexDepcode"
                                        type="text"
                                        class="form-control light"
                                        [(ngModel)]="department.rec['DEPARTMENT_INDEX']"
                                        placeholder="{{fieldsDescription.rec['indexDep']?.title}}"
                                        maxlength="{{fieldsDescription.rec['indexDep']?.length}}">
                                    <button [ngClass]="{'hide': !department.rec['DEPARTMENT_INDEX']}"
                                        (click)="department.rec['DEPARTMENT_INDEX'] = ''">
                                        <span class="eos-icon eos-icon-close-blue"></span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-9 col-lg-9 col-xl-9">
                            <div class="form-group unimportant-text">
                                <label for="title">{{fieldsDescription.rec['title']?.title}}</label>
                                <div class="wrap">
                                    <input id="title"
                                        name="title"
                                        type="text"
                                        class="form-control light"
                                        [(ngModel)]="department.rec['CLASSIF_NAME']"
                                        placeholder="{{fieldsDescription.rec['title']?.title}}"
                                        maxlength="{{fieldsDescription.rec['title']?.length}}">
                                    <button [ngClass]="{'hide': !department.rec['CLASSIF_NAME']}"
                                        (click)="department.rec['CLASSIF_NAME'] = ''">
                                        <span class="eos-icon eos-icon-close-blue"></span>
                                    </button>
                                </div>
                            </div>
                            <div class="form-group unimportant-text">
                                <label for="fullTitle">{{fieldsDescription.rec['fullTitle']?.title}}</label>
                                <div class="wrap">
                                    <input id="fullTitle"
                                        name="fullTitle"
                                        type="text"
                                        class="form-control light"
                                        [(ngModel)]="department.rec['FULLNAME']"
                                        placeholder="{{fieldsDescription.rec['fullTitle']?.title}}"
                                        maxlength="{{fieldsDescription.rec['fullTitle']?.length}}">
                                    <button [ngClass]="{'hide': !department.rec['FULLNAME']}"
                                        (click)="department.rec['FULLNAME'] = ''">
                                        <span class="eos-icon eos-icon-close-blue"></span>
                                    </button>
                                </div>
                            </div>
                            <div class="form-group unimportant-text">
                                <label for="DEPARTMENT_NOTE">{{fieldsDescription.rec['NOTE']?.title}}</label>
                                <div class="wrap">
                                    <input id="DEPARTMENT_NOTE"
                                        name="DEPARTMENT_NOTE"
                                        type="text"
                                        class="form-control light"
                                        [(ngModel)]="department.rec['NOTE']"
                                        placeholder="{{fieldsDescription.rec['NOTE']?.title}}"
                                        maxlength="{{fieldsDescription.rec['NOTE']?.length}}"
                                        readonly>
                                    <button [ngClass]="{'hide': !department.rec['NOTE']}"
                                        (click)="department.rec['NOTE'] = ''">
                                    <span class="eos-icon eos-icon-close-blue"></span>
                                </button>
                                </div>
                            </div>
                        </div>
                    </form>
                    </div>
                </div>
                <div [hidden]="dictId !== 'rubricator'"
                    *ngIf="data.rec"
                    class="row full-search-form">
                    <div class="col-md-3 col-lg-3 col-xl-3">
                        <div class="form-group unimportant-text">
                            <label for="code">{{fieldsDescription.rec['RUBRIC_CODE']?.title}}</label>
                            <div class="wrap">
                                <input id="code"
                                    name="code"
                                    type="text"
                                    class="form-control light"
                                    [(ngModel)]="data.rec['RUBRIC_CODE']"
                                    placeholder="{{fieldsDescription.rec['RUBRIC_CODE']?.title}}"
                                    maxlength="{{fieldsDescription.rec['RUBRIC_CODE']?.length}}">
                                <button [ngClass]="{'hide': !data.rec['RUBRIC_CODE']}"
                                    (click)="data.rec['RUBRIC_CODE'] = ''">
                                <span class="eos-icon eos-icon-close-blue"></span>
                            </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-9 col-lg-9 col-xl-9">
                        <div class="form-group unimportant-text">
                            <label for="title">{{fieldsDescription.rec['CLASSIF_NAME']?.title}}</label>
                            <div class="wrap">
                                <input id="title"
                                    name="title"
                                    type="text"
                                    class="form-control light"
                                    [(ngModel)]="data.rec['CLASSIF_NAME']"
                                    placeholder="{{fieldsDescription.rec['CLASSIF_NAME']?.title}}"
                                    maxlength="{{fieldsDescription.rec['CLASSIF_NAME']?.length}}">
                                <button [ngClass]="{'hide': !data.rec['CLASSIF_NAME']}"
                                    (click)="data.rec['CLASSIF_NAME'] = ''">
                                <span class="eos-icon eos-icon-close-blue"></span>
                            </button>
                            </div>
                        </div>

                        <div class="form-group unimportant-text">
                            <label for="fullTitle">{{fieldsDescription.rec['FULLNAME']?.title}}</label>
                            <div class="wrap">
                                <input id="fullTitle"
                                    name="fullTitle"
                                    type="text"
                                    class="form-control light"
                                    [(ngModel)]="data.rec['FULLNAME']"
                                    placeholder="{{fieldsDescription.rec['FULLNAME']?.title}}"
                                    maxlength="{{fieldsDescription.rec['FULLNAME']?.length}}">
                                <button [ngClass]="{'hide': !data.rec['FULLNAME']}"
                                    (click)="data.rec['FULLNAME'] = ''">
                                <span class="eos-icon eos-icon-close-blue"></span>
                            </button>
                            </div>
                        </div>

                        <div class="form-group unimportant-text">
                            <label for="note">{{fieldsDescription.rec['NOTE']?.title}}</label>
                            <div class="wrap">
                                <input id="note"
                                    name="note"
                                    type="text"
                                    class="form-control light"
                                    [(ngModel)]="data.rec['NOTE']"
                                    placeholder="{{fieldsDescription.rec['NOTE']?.title}}"
                                    maxlength="{{fieldsDescription.rec['NOTE']?.length}}"
                                    readonly>
                                <button [ngClass]="{'hide': !data.rec['NOTE']}"
                                    (click)="data.rec['NOTE'] = ''">
                                <span class="eos-icon eos-icon-close-blue"></span>
                            </button>
                            </div>
                        </div>

                    </div>
                </div>
                <div [hidden]="dictId !== 'region'"
                    *ngIf="data.rec"
                    class="full-search-form">
                    <!--
                <div class="form-group unimportant-text">
                    <label for="code" >{{fieldsDescription.rec['CODE']?.title}}</label>
                    <input id="code" name="code" type="text" class="form-control"
                        [(ngModel)]="data.rec['CODE']"
                        placeholder="{{fieldsDescription.rec['CODE']?.title}}"
                        maxlength="{{fieldsDescription.rec['CODE']?.length}}">
                </div>
                -->
                    <!--
                <div class="form-group unimportant-text">
                    <label for="cod-okato" >{{fieldsDescription.rec['COD_OKATO']?.title}}</label>
                    <input id="cod-okato" name="cod-okato" type="text" class="form-control"
                        [(ngModel)]="data.rec['COD_OKATO']"
                        placeholder="{{fieldsDescription.rec['COD_OKATO']?.title}}"
                        maxlength="{{fieldsDescription.rec['COD_OKATO']?.length}}">
                </div>
                -->
                    <div class="form-group unimportant-text">
                        <label for="name">{{fieldsDescription.rec['CLASSIF_NAME']?.title}}</label>
                        <div class="wrap">
                            <input id="name"
                                name="name"
                                type="text"
                                class="form-control"
                                [(ngModel)]="data.rec['CLASSIF_NAME']"
                                placeholder="{{fieldsDescription.rec['CLASSIF_NAME']?.title}}"
                                maxlength="{{fieldsDescription.rec['CLASSIF_NAME']?.length}}">
                            <button [ngClass]="{'hide': !data.rec['CLASSIF_NAME']}"
                                (click)="data.rec['CLASSIF_NAME'] = ''">
                            <span class="eos-icon eos-icon-close-blue"></span>
                        </button>
                        </div>
                    </div>
                    <!--
                <div class="form-group unimportant-text">
                    <label for="note" >{{fieldsDescription.rec['NOTE']?.title}}</label>
                    <input id="note" name="note" type="text" class="form-control"
                        [(ngModel)]="data.rec['NOTE']"
                        placeholder="{{fieldsDescription.rec['NOTE']?.title}}"
                        maxlength="{{fieldsDescription.rec['NOTE']?.length}}">
                </div>
                -->
                </div>
        </form>
        </div>
</ng-template>
